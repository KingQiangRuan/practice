malloc 是C的标准函数库，底层实现涉及虚拟内存管理，内存块分配策略，线程安全等。

内存管理： 内存分配器需要维护空闲内存块链表，记录块状态和大小。分配时选择合适大小的内存块，剩余部分可重新组织为空闲块。

内存对齐： 快头部包含块大小和状态标志，剩余空间为用户可用内存。

1. 分配
小于128K时，
1） 从空闲块链表里找到合适大小的内存，找到分成2份，一份变为分配块，一份变成新的空闲块。
2） 没找到，调用brk() 函数移动堆段末尾指针，在堆空间分配。

大于128K时
1） 使用mmap（）系统调用在虚拟地址空间的“文件映射区”分配独立内存块。

2. 回收
释放是，不会立即释放，标记为空闲，不会立即还给OS，等待后续分配请求，减少系统调用。


=============================================
slab 和 brk（）区别

1. slab
内核态内存分配器，专为进程描述符，文件描述符等小对象使用，通过对象缓存和分层管理减少碎片化。

2. brk
 用户空间内存分配的系统调用函数，通过移动堆顶指针来扩展或收缩进程的对空间。是用户态内存管理机制的底层实现。
malloc函数调用，主要用于分配小于128K的内存

用户态(brk/mmap）

内核态（slab/buddy）,slab 分配器依赖buddy来获取物理页
